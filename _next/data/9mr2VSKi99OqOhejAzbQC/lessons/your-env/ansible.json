{"pageProps":{"post":{"attributes":{"title":"Ansible","description":"ansible"},"html":"<h2>Ansible</h2>\n<p>Now a long running way I have been using to manage my dotfiles have been\nexclusively through ansible.  There are several pluses to managing through\nansible and there are some negatives</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Pros</h2>\n<ul>\n<li>there is tons of online documentation</li>\n<li>its used more than just managing dotfiles</li>\n<li>ansible vault allows for plain storage of ssh keys!  which is really cool</li>\n<li>you can also store a bunch of other cool stuff with ansible vault (think auth passcodes)</li>\n</ul>\n<h2>Cons</h2>\n<ul>\n<li>it can be terribly slow</li>\n<li>it can be hard to make it work for certain tasks, such as installing neovim\nplugins</li>\n<li>tags can be great and super annoying</li>\n<li>yaml sucks</li>\n</ul>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Basic Ansible</h2>\n<p>lets create a simple ansible script to clone neovim from source and build it\nfrom a specific tagged version</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>What is ansible?</h2>\n<p>From their github <br></p>\n<blockquote>\n<p>Ansible is a radically simple IT automation system. It handles configuration management, application deployment, cloud provisioning, ad-hoc task execution, network automation, and multi-node orchestration. Ansible makes complex changes like zero-downtime rolling updates with load balancers easy. More information on the Ansible website.</p>\n</blockquote>\n<p>You are probably thinking... wait... aren&#39;t we talking about dotfiles and environments?</p>\n<br>\n<br>\n\n<p>Why yes we are!</p>\n<br>\n<br>\n\n<p>This is a tool designed for &quot;servers&quot; and if you squint your eyes you will\nrealize that you are just working on a &quot;server.&quot;</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>NOTE: feel free to just watch</h2>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n\n<h2>Install ansible</h2>\n<p>as all adventures start...</p>\n<pre><code>pip3 install ansible\n</code></pre><br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>The heart of ansible</h2>\n<p>Typically when you are working with ansible you are using an inventory, which\nis a list of all servers you have proper access to, and a series of playbooks.\nThe playbooks are where we specify the tasks we wish to perform on one or more\nnodes (machines).  The playbook is the heart of ansible</p>\n<br>\n<br>\n\n<p>As a friend once said</p>\n<blockquote>\n<p>ansible is the helicopter that drops godzilla</p>\n<p>... godzilla being k8s</p>\n</blockquote>\n<br>\n<br>\n\n<p>Since we are operating on our own machine we wont need the inventory part, its\njust <code>localhost</code></p>\n<br>\n<br>\n\n<p>Lets just jump right into the playbook side of ansible which is where all the\nwork is done</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Your First Playbook</h2>\n<p>Lets start off by creating a playbook that will use git to download the\ncontents of neovim to a directory in a directory of our choosing</p>\n<ul>\n<li>create a new directory, lets call it <code>mfansible</code></li>\n<li>create a file called <code>neovim.yml</code></li>\n<li>input the following</li>\n</ul>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">My</span> <span class=\"hljs-string\">first</span> <span class=\"hljs-string\">playbook</span>\n  <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">localhost</span>\n  <span class=\"hljs-attr\">tasks:</span>\n</code></pre><p>with this alone we can now execute ansible and see the effects</p>\n<pre><code>ansible-playbook neovim.yml\n</code></pre><p>and you should see output that is similar to</p>\n<pre><code>➜  ansible-neovim-example git:(master) ✗ ansible-playbook neovim.yml\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match &#x27;all&#x27;\n\nPLAY [The Great Neovim editor] *****************************************************************************************************\n\nTASK [Gathering Facts] *************************************************************************************************************\nok: [localhost]\n\nPLAY RECAP *************************************************************************************************************************\nlocalhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n</code></pre><br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Congrats!</h2>\n<p>you have ran your first ansible script!</p>\n<p>Lets do some git</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Lets clone down neovim!</h2>\n<p>When it comes to using ansible, one of my favorite features is the docs and how\nthey are organized.  it just makes it so simple to google and get the exact\nanswer out you need.  ChatGPT is nice to use, but can sometimes lead you into\ntoo much usage of odd features like scripting</p>\n<ul>\n<li>Google ansible git clone</li>\n<li>scroll the documentation and copy the one they suggest</li>\n<li>perhaps combine a few to make this most efficient!</li>\n</ul>\n<br>\n<br>\n\n<p>But where do we put the code we find?  Well... remember that empty <code>tasks</code> key?</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Expected Task Output</h2>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">My</span> <span class=\"hljs-string\">first</span> <span class=\"hljs-string\">playbook</span>\n  <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">localhost</span>\n  <span class=\"hljs-attr\">tasks:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Git</span> <span class=\"hljs-string\">neovim</span>\n    <span class=\"hljs-attr\">ansible.builtin.git:</span>\n      <span class=\"hljs-attr\">repo:</span> <span class=\"hljs-string\">&quot;https://github.com/neovim/neovim.git&quot;</span>\n      <span class=\"hljs-attr\">dest:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ lookup(&#x27;ansible.builtin.env&#x27;, &#x27;HOME&#x27;) }}</span>/personal/neovim&quot;</span>\n      <span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">v0.10.2</span>\n</code></pre><br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Become familiar with the build first</h2>\n<p>there will be several libs that you may require to get this working so to do\nthis correctly you will first want to build neovim by hand and keep track of\nthe libraries that you need.  There is likely a list of requirements in the\n<a href=\"https://github.com/neovim/neovim/blob/master/BUILD.md\">BUILD.md</a></p>\n<h3>Making neovim requires packages</h3>\n<p>Here are the packages i needed to install from apt to get neovim</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">sudo</span> apt install cmake gettext lua5.1 liblua5.1-0-dev\n</code></pre><h3>Lets get the libraries first</h3>\n<p>Lets translate what I installed into an ansible command.</p>\n<ul>\n<li>google how to ansible apt</li>\n<li>copy the proper command</li>\n</ul>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Expected Code</h2>\n<p>Your code should look something like this</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">My</span> <span class=\"hljs-string\">first</span> <span class=\"hljs-string\">playbook</span>\n  <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">localhost</span>\n  <span class=\"hljs-attr\">tasks:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Git</span> <span class=\"hljs-string\">neovim</span>\n    <span class=\"hljs-attr\">ansible.builtin.git:</span>\n      <span class=\"hljs-attr\">repo:</span> <span class=\"hljs-string\">&quot;https://github.com/neovim/neovim.git&quot;</span>\n      <span class=\"hljs-attr\">dest:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ lookup(&#x27;ansible.builtin.env&#x27;, &#x27;HOME&#x27;) }}</span>/personal/neovim&quot;</span>\n      <span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">v0.10.2</span>\n\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">helping</span> <span class=\"hljs-string\">libs</span>\n    <span class=\"hljs-attr\">become:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">ansible.builtin.apt:</span>\n      <span class=\"hljs-attr\">pkg:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">lua5.1</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">liblua5.1-0-dev</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">cmake</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gettext</span>\n</code></pre><br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>OH NO! Crash!</h2>\n<p>If you are using apt and have to use sudo you should see the following error.</p>\n<pre><code class=\"hljs language-bash\">TASK [Install neovim<span class=\"hljs-string\">&#x27;s deps] *********************************************************\nfatal: [localhost]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;module_stderr&quot;: &quot;sudo: a password is required\\n&quot;, &quot;module_stdout&quot;: &quot;&quot;, &quot;msg&quot;: &quot;MODULE FAILURE\\nSee stdout/stderr for the exact error&quot;, &quot;rc&quot;: 1}</span>\n</code></pre><p>Well ansible does have the ability to become the sudo but it needs the creds to\ndo it, you can type in those creds before installing by using the -K flag</p>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Now build!</h2>\n<p>Now all we have to build neovim and then sudo make install!  We do the same\nprocess</p>\n<ul>\n<li>google make</li>\n<li>copy the relevant instructions</li>\n<li>implement the new tasks</li>\n<li>...</li>\n<li>neovim (which is profit)!</li>\n</ul>\n<h3>To make neovim (from BUILD.md)</h3>\n<p>The command to run to make neovim is the following:</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">cd</span> neovim &amp;&amp; make CMAKE_BUILD_TYPE=RelWithDebInfo\n</code></pre><p>then to install it we need to execute</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">sudo</span> make install\n</code></pre><br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>Expected output</h2>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">My</span> <span class=\"hljs-string\">first</span> <span class=\"hljs-string\">playbook</span>\n  <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">localhost</span>\n  <span class=\"hljs-attr\">tasks:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Git</span> <span class=\"hljs-string\">neovim</span>\n    <span class=\"hljs-attr\">ansible.builtin.git:</span>\n      <span class=\"hljs-attr\">repo:</span> <span class=\"hljs-string\">&quot;https://github.com/neovim/neovim.git&quot;</span>\n      <span class=\"hljs-attr\">dest:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ lookup(&#x27;ansible.builtin.env&#x27;, &#x27;HOME&#x27;) }}</span>/personal/neovim&quot;</span>\n      <span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">v0.9.4</span>\n\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">helping</span> <span class=\"hljs-string\">libs</span>\n    <span class=\"hljs-attr\">become:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">ansible.builtin.apt:</span>\n      <span class=\"hljs-attr\">pkg:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">lua5.1</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">liblua5.1-0-dev</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">cmake</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gettext</span>\n\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">neovim</span>\n    <span class=\"hljs-attr\">make:</span>\n      <span class=\"hljs-attr\">chdir:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ lookup(&#x27;ansible.builtin.env&#x27;, &#x27;HOME&#x27;) }}</span>/personal/neovim&quot;</span>\n      <span class=\"hljs-attr\">params:</span>\n        <span class=\"hljs-attr\">CMAKE_BUILD_TYPE:</span> <span class=\"hljs-string\">&quot;RelWithDebInfo&quot;</span>\n\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">neovim</span> <span class=\"hljs-string\">install</span>\n    <span class=\"hljs-attr\">become:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">make:</span>\n      <span class=\"hljs-attr\">target:</span> <span class=\"hljs-string\">install</span>\n      <span class=\"hljs-attr\">chdir:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ lookup(&#x27;ansible.builtin.env&#x27;, &#x27;HOME&#x27;) }}</span>/personal/neovim&quot;</span>\n</code></pre><br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n<h2>And that is ansible</h2>\n<p>that is what it takes to create neovim ansible.</p>\n<br>\n<br>\n\n<h3>Why would i use this over a bash script</h3>\n<p>A bash script is great when you can execute it on a machine, but ansible allows\nyou to execute all these operations on a bunch of host machines at once, your\nmachine, uniform syntax (yml).  It also allows for some custom logic based on\noperating system so you could interchange out the fetching mechanism to make it\nmachine independent</p>\n<br>\n<br>\n\n<p>Ansible can be real great.  It &quot;seems&quot; easier to maintain than having a bunch\nof bash scripts for each operating system.  It can also make automating your\nsetup a bit easier.</p>\n<br>\n<br>\n\n<p>But for me... its a no at this point.  I prefer a single script that i control</p>\n<ul>\n<li>some basic convention.  Convention over configuration is a mantra i support</li>\n</ul>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n","markdown":"\n## Ansible\nNow a long running way I have been using to manage my dotfiles have been\nexclusively through ansible.  There are several pluses to managing through\nansible and there are some negatives\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Pros\n* there is tons of online documentation\n* its used more than just managing dotfiles\n* ansible vault allows for plain storage of ssh keys!  which is really cool\n* you can also store a bunch of other cool stuff with ansible vault (think auth passcodes)\n\n## Cons\n* it can be terribly slow\n* it can be hard to make it work for certain tasks, such as installing neovim\n  plugins\n* tags can be great and super annoying\n* yaml sucks\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Basic Ansible\nlets create a simple ansible script to clone neovim from source and build it\nfrom a specific tagged version\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## What is ansible?\nFrom their github <br>\n> Ansible is a radically simple IT automation system. It handles configuration management, application deployment, cloud provisioning, ad-hoc task execution, network automation, and multi-node orchestration. Ansible makes complex changes like zero-downtime rolling updates with load balancers easy. More information on the Ansible website.\n\nYou are probably thinking... wait... aren't we talking about dotfiles and environments?\n\n<br>\n<br>\n\nWhy yes we are!\n\n<br>\n<br>\n\nThis is a tool designed for \"servers\" and if you squint your eyes you will\nrealize that you are just working on a \"server.\"\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## NOTE: feel free to just watch\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n\n## Install ansible\nas all adventures start...\n\n```\npip3 install ansible\n```\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## The heart of ansible\nTypically when you are working with ansible you are using an inventory, which\nis a list of all servers you have proper access to, and a series of playbooks.\nThe playbooks are where we specify the tasks we wish to perform on one or more\nnodes (machines).  The playbook is the heart of ansible\n\n<br>\n<br>\n\nAs a friend once said\n> ansible is the helicopter that drops godzilla\n>\n>\n>\n>\n>\n>\n>\n>\n>\n>\n>\n> ... godzilla being k8s\n\n<br>\n<br>\n\nSince we are operating on our own machine we wont need the inventory part, its\njust `localhost`\n\n<br>\n<br>\n\nLets just jump right into the playbook side of ansible which is where all the\nwork is done\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Your First Playbook\nLets start off by creating a playbook that will use git to download the\ncontents of neovim to a directory in a directory of our choosing\n\n* create a new directory, lets call it `mfansible`\n* create a file called `neovim.yml`\n* input the following\n\n```yml\n- name: My first playbook\n  hosts: localhost\n  tasks:\n```\n\nwith this alone we can now execute ansible and see the effects\n\n```\nansible-playbook neovim.yml\n```\n\nand you should see output that is similar to\n\n```\n➜  ansible-neovim-example git:(master) ✗ ansible-playbook neovim.yml\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'\n\nPLAY [The Great Neovim editor] *****************************************************************************************************\n\nTASK [Gathering Facts] *************************************************************************************************************\nok: [localhost]\n\nPLAY RECAP *************************************************************************************************************************\nlocalhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n```\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Congrats!\nyou have ran your first ansible script!\n\nLets do some git\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Lets clone down neovim!\nWhen it comes to using ansible, one of my favorite features is the docs and how\nthey are organized.  it just makes it so simple to google and get the exact\nanswer out you need.  ChatGPT is nice to use, but can sometimes lead you into\ntoo much usage of odd features like scripting\n\n* Google ansible git clone\n* scroll the documentation and copy the one they suggest\n* perhaps combine a few to make this most efficient!\n\n<br>\n<br>\n\nBut where do we put the code we find?  Well... remember that empty `tasks` key?\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Expected Task Output\n\n\n```yaml\n- name: My first playbook\n  hosts: localhost\n  tasks:\n  - name: Git neovim\n    ansible.builtin.git:\n      repo: \"https://github.com/neovim/neovim.git\"\n      dest: \"{{ lookup('ansible.builtin.env', 'HOME') }}/personal/neovim\"\n      version: v0.10.2\n```\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Become familiar with the build first\nthere will be several libs that you may require to get this working so to do\nthis correctly you will first want to build neovim by hand and keep track of\nthe libraries that you need.  There is likely a list of requirements in the\n[BUILD.md](https://github.com/neovim/neovim/blob/master/BUILD.md)\n\n### Making neovim requires packages\nHere are the packages i needed to install from apt to get neovim\n\n```bash\nsudo apt install cmake gettext lua5.1 liblua5.1-0-dev\n```\n\n### Lets get the libraries first\nLets translate what I installed into an ansible command.\n\n* google how to ansible apt\n* copy the proper command\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Expected Code\nYour code should look something like this\n\n```yaml\n- name: My first playbook\n  hosts: localhost\n  tasks:\n  - name: Git neovim\n    ansible.builtin.git:\n      repo: \"https://github.com/neovim/neovim.git\"\n      dest: \"{{ lookup('ansible.builtin.env', 'HOME') }}/personal/neovim\"\n      version: v0.10.2\n\n  - name: Install helping libs\n    become: true\n    ansible.builtin.apt:\n      pkg:\n      - lua5.1\n      - liblua5.1-0-dev\n      - cmake\n      - gettext\n```\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## OH NO! Crash!\nIf you are using apt and have to use sudo you should see the following error.\n\n```bash\nTASK [Install neovim's deps] *********************************************************\nfatal: [localhost]: FAILED! => {\"changed\": false, \"module_stderr\": \"sudo: a password is required\\n\", \"module_stdout\": \"\", \"msg\": \"MODULE FAILURE\\nSee stdout/stderr for the exact error\", \"rc\": 1}\n```\n\nWell ansible does have the ability to become the sudo but it needs the creds to\ndo it, you can type in those creds before installing by using the -K flag\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Now build!\nNow all we have to build neovim and then sudo make install!  We do the same\nprocess\n\n* google make\n* copy the relevant instructions\n* implement the new tasks\n* ...\n* neovim (which is profit)!\n\n### To make neovim (from BUILD.md)\nThe command to run to make neovim is the following:\n\n```bash\ncd neovim && make CMAKE_BUILD_TYPE=RelWithDebInfo\n```\n\nthen to install it we need to execute\n\n```bash\nsudo make install\n```\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## Expected output\n```yaml\n- name: My first playbook\n  hosts: localhost\n  tasks:\n  - name: Git neovim\n    ansible.builtin.git:\n      repo: \"https://github.com/neovim/neovim.git\"\n      dest: \"{{ lookup('ansible.builtin.env', 'HOME') }}/personal/neovim\"\n      version: v0.9.4\n\n  - name: Install helping libs\n    become: true\n    ansible.builtin.apt:\n      pkg:\n      - lua5.1\n      - liblua5.1-0-dev\n      - cmake\n      - gettext\n\n  - name: neovim\n    make:\n      chdir: \"{{ lookup('ansible.builtin.env', 'HOME') }}/personal/neovim\"\n      params:\n        CMAKE_BUILD_TYPE: \"RelWithDebInfo\"\n\n  - name: neovim install\n    become: true\n    make:\n      target: install\n      chdir: \"{{ lookup('ansible.builtin.env', 'HOME') }}/personal/neovim\"\n```\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n## And that is ansible\nthat is what it takes to create neovim ansible.\n\n<br>\n<br>\n\n### Why would i use this over a bash script\nA bash script is great when you can execute it on a machine, but ansible allows\nyou to execute all these operations on a bunch of host machines at once, your\nmachine, uniform syntax (yml).  It also allows for some custom logic based on\noperating system so you could interchange out the fetching mechanism to make it\nmachine independent\n\n<br>\n<br>\n\nAnsible can be real great.  It \"seems\" easier to maintain than having a bunch\nof bash scripts for each operating system.  It can also make automating your\nsetup a bit easier.\n\n<br>\n<br>\n\nBut for me... its a no at this point.  I prefer a single script that i control\n+ some basic convention.  Convention over configuration is a mantra i support\n\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n\n","slug":"ansible","title":"Ansible","section":"Your Env","icon":"info-circle","filePath":"/home/runner/work/dev-prod-2/dev-prod-2/lessons/02-your-env/B-ansible.md","nextSlug":"/dev-prod-2/lessons/your-env/roll-your-own","prevSlug":"/dev-prod-2/lessons/your-env/your-env"}},"__N_SSG":true}